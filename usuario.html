<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mapa de Cargadores</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-gray-300 flex flex-col items-center p-6 relative">

<h1 class="text-3xl font-bold mb-4 text-center">Mapa de Cargadores</h1>

<div id="map" class="w-3/4 h-96 rounded-lg shadow-lg relative z-10"></div>

<button onclick="cerrarSesion()" class="mt-4 bg-red-600 text-white px-4 py-2 rounded">Cerrar Sesión</button>

<!-- Modal de Información -->
<div id="modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-lg shadow-lg text-gray-900 relative w-1/3">
    <span class="absolute top-2 right-4 text-xl cursor-pointer" onclick="cerrarModal()">&times;</span>
    <h2 class="text-2xl font-bold mb-2">Detalles del Cargador</h2>
    <p id="infoCargador" class="mb-4"></p>
    <button id="reservarBtn" class="bg-green-600 text-white px-4 py-2 rounded" onclick="mostrarFormularioReserva()">Reservar</button>
  </div>
</div>

<!-- Modal de Reserva -->
<div id="modalReserva" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-lg shadow-lg text-gray-900 relative w-1/3">
    <span class="absolute top-2 right-4 text-xl cursor-pointer" onclick="cerrarFormularioReserva()">&times;</span>
    <h2 class="text-2xl font-bold mb-2">Formulario de Reserva</h2>
    <label class="block mb-2">Nombre: <input type="text" id="nombre" class="border p-2 rounded w-full"></label>
    <label class="block mb-2">Email: <input type="email" id="email" class="border p-2 rounded w-full" placeholder="Ingrese su correo" oninput="validarEmail()"></label>
    <p id="emailError" class="text-red-600 hidden">Por favor, introduzca un correo válido con '@'</p>
    <button onclick="confirmarReserva()" class="bg-blue-600 text-white px-4 py-2 rounded mt-4">Confirmar Reserva</button>
  </div>
</div>

<script>
  var map = L.map('map').setView([40.416775, -3.703790], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap'
  }).addTo(map);

  var estadosCargadores = {
    "libre": "green",
    "ocupado": "red",
    "en reparación": "gray"
  };

  var cargadores = [
    { "id": 1, "tipo": "rápido", "ubicacion": [40.4168, -3.7038], "estado": "libre", "nivel_bateria": 80, "tiempo_estimado": 30 },
    { "id": 2, "tipo": "estándar", "ubicacion": [40.4128, -3.7100], "estado": "ocupado", "nivel_bateria": 50, "tiempo_estimado": 60 },
    { "id": 3, "tipo": "compatible", "ubicacion": [40.4200, -3.7050], "estado": "en reparación", "nivel_bateria": 20, "tiempo_estimado": 90 },
    { "id": 4, "tipo": "rápido", "ubicacion": [40.4150, -3.7000], "estado": "libre", "nivel_bateria": 100, "tiempo_estimado": 30 },
    { "id": 5, "tipo": "estándar", "ubicacion": [40.4100, -3.7100], "estado": "ocupado", "nivel_bateria": 70, "tiempo_estimado": 60 },
    { "id": 6, "tipo": "compatible", "ubicacion": [40.4200, -3.7000], "estado": "en reparación", "nivel_bateria": 40, "tiempo_estimado": 90 }
  ];

  cargadores.forEach(cargador => {
    var marker = L.circleMarker(cargador.ubicacion, {
      color: estadosCargadores[cargador.estado],
      fillColor: estadosCargadores[cargador.estado],
      fillOpacity: 0.8,
      radius: 10
    }).addTo(map);

    marker.on('click', function() {
      document.getElementById('infoCargador').innerText = `Cargador ${cargador.id} - Tipo: ${cargador.tipo}\nEstado: ${cargador.estado}\nNivel de batería: ${cargador.nivel_bateria}%\nTiempo estimado: ${cargador.tiempo_estimado} min`;
      document.getElementById('modal').classList.remove('hidden');
    });
  });

  function cerrarModal() {
    document.getElementById('modal').classList.add('hidden');
  }

  function mostrarFormularioReserva() {
    document.getElementById('modal').classList.add('hidden');
    document.getElementById('modalReserva').classList.remove('hidden');
  }

  function cerrarFormularioReserva() {
    document.getElementById('modalReserva').classList.add('hidden');
  }

  function validarEmail() {
    let email = document.getElementById('email').value;
    let emailError = document.getElementById('emailError');
    if (!email.includes('@')) {
      emailError.classList.remove('hidden');
    } else {
      emailError.classList.add('hidden');
    }
  }

  function confirmarReserva() {
    let nombre = document.getElementById('nombre').value;
    let email = document.getElementById('email').value;
    if (!email.includes('@')) {
      alert("Por favor, introduzca un correo válido con '@'");
      return;
    }
    if (nombre && email) {
      alert("Reserva realizada con éxito");
      cerrarFormularioReserva();
    } else {
      alert("Por favor, complete todos los campos");
    }
  }
</script>
</body>
</html>
